{% extends 'base.html' %}
{% load staticfiles %}

{% block title %}
Vendor products
{% endblock %}

{% block content %}
    <h1>Browse vendor product lists</h1>
    <p>On this page, you can browse the local database based on a specific vendor.</p>
    {% if vendors|length > 0 %}
    <p>Please select a vendor that should be displayed:</p>
    <div class="container">
        <form class="form-horizontal" method="post">
            <div class="form-group">
                <label for="vendor_selection" class="col-sm-2 control-label">Vendor to display: </label>
                <div class="col-sm-10">
                    <select class="form-control" id="vendor_selection" name="vendor_selection">
                    {% for ven in vendors %}
                        {% if vendor_selection %}
                            {% ifequal ven.id|add:"0" vendor_selection|add:"0" %}
                            <option value="{{ ven.id }}" selected>{{ ven.name }}</option>
                            {% else %}
                            <option value="{{ ven.id }}">{{ ven.name }}</option>
                            {% endifequal %}
                        {% else %}
                            <option value="{{ ven.id }}">{{ ven.name }}</option>
                        {% endif %}
                    {% endfor %}
                    </select>
                </div>
            </div>
            <div class="text-center">
                <input class="btn btn-default" type="submit" id="submit" value="view vendor products" />
            </div>
            {% csrf_token %}
        </form>
    </div>
    <hr>
    <div class="container">
        <table id="product_table" class="table table-striped table-hover" cellspacing="0" width="100%">
            <thead>
                <tr>
                    <th width="20%">product ID</th>
                    <th>description</th>
                    <th width="20%">list price</th>
                </tr>
            </thead>
        </table>
    </div>
    {% else %}
    <div class="container">
        <div class="alert alert-warning" role="alert">
            <strong>Warning:</strong> No vendor found in database.
        </div>
    </div>
    {% endif %}
{% endblock %}

{% block end_of_file_statments %}
    <script src="{% static 'lib/datatables.net-buttons/js/buttons.colVis.min.js' %}"></script>
    <script type="application/javascript">
        $(document).ready(function() {
            if($('#vendor_selection').val() != null) {
                update_datatable()
            }
        });

        function update_datatable() {
            var vs = $('#vendor_selection');
            var table = $('#product_table').DataTable( {
                dom: "<'row'<'col-sm-4'l><'col-sm-4'<'text-center'B>><'col-sm-4'f>>" +
                     "<'row'<'col-sm-12'tr>>" +
                     "<'row'<'col-sm-5'i><'col-sm-7'p>>",
                "processing": true,
                "serverSide": true,
                "columns": [
                    {
                        "data": "product_id",
                        "visible": true,
                        "searchable": true
                    },
                    {
                        "data": "description",
                        "visible": true,
                        "searchable": true
                    },
                    {
                        "data": "list_price",
                        "visible": true,
                        "searchable": false,
                        "render": function ( data, type, row ) {
                            if (data != null) {
                                return data + ' ' + row['currency'] + '';
                            }
                            else {
                                return "(not set)"
                            }
                        }
                    }
                ],
                buttons: [
                    'copyHtml5',
                    {
                        extend: 'csvHtml5',
                        title: "vendor products - " + vs.find("option[value=" + vs.val() + "]").text(),
                        fieldSeparator: ';',
                        fieldBoundary: "",
                        exportOptions: {
                            columns: ':visible'
                        },
                        extension: '.csv'
                    },
                    {
                        extend: 'pdfHtml5',
                        title: "vendor products - " + vs.find("option[value=" + vs.val() + "]").text(),
                        orientation: 'landscape',
                        pageSize: 'A4'
                    },
                    'colvis'
                ],
                "ajax": "{% url 'productdb:datatables_vendor_products_view' %}" + vs.val() + "/"
            });
        }
    </script>
{% endblock %}